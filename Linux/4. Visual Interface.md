# 📖 Table of Contents
* [Linux 文本编辑器](#linux-文本编辑器)
  * [Vi编辑器的工作模式](#vi编辑器的工作模式)
    * [命令模式](#命令模式) 
    * [输入模式](#输入模式)
    * [ex转义模式(行编辑处理)](#ex转义模式行编辑处理)
  * [Vi编辑器的使用](#Vi编辑器的使用)
    * [进入文件时定位 `定位到词,行`](#进入文件时定位-定位到词行)
    * [移动光标 `精确移动大范围移动`](#移动光标-精确移动大范围移动)
    * [文本修改 `删除字,行,段落位移,恢复`](#文本修改-删除字行段落位移恢复)
    * [内容检索](#内容检索)
    * [单纯检索](#单纯检索)
    * [替换检索](#替换检索)
  * [EX命令](#EX命令)
  * [Conclusion](#Conclusion) 


# Linux 文本编辑器

文件可以简单分为文本文件、数据文件、数据库文件、程序源文件。Linux系统常用的文本编辑器是按功能分为两类：*行编辑器*(ed、ex、edit)和*屏幕编辑器*(vi)。
我们重点讲解`vi`，vi的全称是`Visual Interface`，它汇集了行编辑器和屏幕编辑器的特点，几乎所有的UNIX/Linux系统都采用`vi`编辑器处理**纯文本文件**。
在Linux系统中还提供`vim`编辑器，它是`vi`的增强版`vi imporved`，它支持多窗口、缓冲、语法高亮、命令行编辑、联机帮助等功能，如今在Linux系统中用的`vi`其实大都是`vim`。

- [ ]  vim的工作模式 命令模式、输入模式、ex转义模式
    - [x]  通过vim进入文件时的操作
    - [x]  在vim内部光标的移动
    - [x]  文件内容的查找，替换，修改
    - [x]  文件的保存，切换与vim的退出

## Vi编辑器的工作模式

`vi`编辑器有三种工作模式：命令模式、输入模式和ex转义模式。通过相应的命令或操作可以在这3种方式间进行转换。

### 命令模式

在shell提示符输入命令vi，进入vi编辑器，就处于命令模式了。此时从键盘上的任何字符都被作为编辑命令来解释。
例如a(append)表示附加命令，i(insert)表示插入命令，x表示删除命令等。如果输入的字符不是vi的合法命令，机器会发出“报警声”，光标不移动。
另外，在命令模式下输入的命令（字符）都不会显示出来，例如，输入i，屏幕并无变化，但编辑器的工作方式会发生变化：由命令模式变为输入模式。
**vi默认先进入命令模式**。

### 输入模式

**从命令模式进入输入模式有很多种**，i(插入命令) a(附加命令) o(打开命令) s(替换命令) c(修改命令) r(取代命令)等。
当进入输入模式后，从键盘上输入的所有字符都被插入到正在编辑的缓冲区中，被当作该文件的正文。进入输入模式后，输入的可见字符都在屏幕上显示出来，
命令模式不再起作用。**由输入模式回到命令模式的方法是按`esc`键**，如果已在命令模式下，按`esc`键就会发出“嘟嘟”声提示。

| command       | function                       |
|---------------|--------------------------------|
| i             | 在光标位置之前插入文本             |
| I             | 在光标所在行的首字符之前插入文本    |
| a             | 在光标所在行的首字符之前插入文本    |
| A             | 在光标所在行的行尾之后插入文本      |



### ex转义模式(行编辑处理)

**只能从命令模式进入ex转义模式，输入`:` 进入ex转义模式**，在该模式下完成行编辑处理。在ex模式中，命令是以`Enter`键结束的命令行。
vi有专门的ex命令，只有进入ex转义模式才能执行ex命令。在命令模式下进入ex转义模式，输入`:`作为ex命令提示符，
冒号出现在状态行(通常在terminal最下一行)，按中断键(**`del`**)可以终止正在执行的命令。转义命令执行完后自动回到命令模式。
多数的文件管理命令都是在ex转义模式下完成的（比如读取文件，把编辑缓冲区的内容写到文件中等)。

```
:1,$ s/I/i/g                // 在ex转义模式下，从文件的第一行(1)到文件末尾($)将大写I替换(s)成小写i
```

## Vi编辑器的使用

### 进入文件时定位 `定位到词,行`

在terminal中输入以下命令进入vi界面

| vi filename          | 最常用的方式，如果指定的文件不存在，则自动建立该文件                   |
|----------------------|---------------------------------------------------------------|
| vi +行号 filename       | 从指定行进入vi，光标位于该行行首                                   |
| vi +`/` word filename  | 从指定词进入vi，找出词第一次出现的行，光标位于该行行首 ( 别忘了 / )     |
| vi file1 file2 ... | 同时调用多个文件，依次进行编辑。完成第一个文件的处理后先 `:w` 存盘，再 `:n` 进入下一个文件。 |

- ***NOTE:在定位词时，如果word中如果包含`!@#*%&$.^()[]\/等`则需要使用转义字符，在这些字符前面加上反斜线`\`,使其失去特殊含义，今当作一般字符对待***

### 移动光标 `精确移动大范围移动`

**移动光标指令全部在命令模式下完成**，其中利用`Ctrl g`可以显示出文件名，[状态]，光标所在行的当前行数，文件的总行数，占比，列数信息。
**用这种方式可以帮助你确定文件是否被修改**。

```
"mytextfile" [Modified] line 4 of 16 --25%-- col 10         // Ctrl+g,文件被修改
"mytextfile" line 12 of 16 --75%-- col 25                           // Ctrl+g,文件未被修改
```

[Untitled](https://www.notion.so/2fc6304a35d3493e8ea466e04dcefdbf)

### 文本修改 `删除字,行,段落位移,恢复`

**在命令模式下的文本修改**。

| command       | function                       | command              | function                 |
|---------------|------------------------------- |----------------------|--------------------------|
| n `x`         | 向右删除n个字符—-x是命令          |  n `X`                | 向左删除n个字符—-X是命令    |
| `D`           | 从光标位置开始删除到行尾           |  `dd`                 | 删除光标所在的整行         |
| `d` 光标移动命令| 从光标位置开始删到光标移动限定的位置 |  例子                  | d3l 从光标位置向右删2(共计3)个字符。d5G 将光标所在行至第5行都删除。dM从当前行一直删除到屏幕中间的行。dL 从当前行一直删除到到屏幕底行的所有行。|
| `u`           | undo 操作                       |   `U`                 | 把当前行恢复到被编辑前的状态，无论光标移到该行后被编辑了几次。    |
| `J`           | 把当前行与下面一行合并成一行        |  `>>` `<<`            | 文本行移动命令。`>>`将当前行右移8个空格，`<<`将当前行左移8个空格 |
|               |                                |  数字 `>>` 或 数字 `<<` | 将当前行及其下面的n-1行(总计n行)都向右或向左移动8个空格。       |


### 内容检索

**字符串检索全部在ex转义模式下完成，因为这涉及到了行的操作，检索时vi是以行为单位进行的**。
编辑文本时，往往需要根据给定的模式检索字符或字符串。检索的目的分为两种：单纯检索和替换检索。

### 单纯检索

| command              | instruction                            |
|----------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| :`/string` +Enter      | 系统从当前行开始向后查找，如果string中包含`!@#*%&$.^()[]\/`等则需要使用转义字符，在这些字符前面加上反斜线`\`,使其失去特殊含义，今当作一般字符对待。找到第一个相匹配的字符串后，光标就停在第一个字符上。如果未找到状态栏显示pattern not found: string |
| :`?string` + Enter     | 从当前行向前开始查找，如果string中包含`!@#*%&$.^()[]\/`等则需要使用转义字符，在这些字符前面加上反斜线`\`,使其失去特殊含义，今当作一般字符对待。如果未找到状态栏显示pattern not found: string    |                     

### 替换检索

- 局部替换
    
    ```
    :s /模式/替代文本/选项
    :s /模式/替代文本/g               //整行全局替换
    :s /模式/替代文本/c               //交互替换/确认替换(confirm)，回答Y替换，N不替换
    :s /模式/替代文本/p               //替换完成后打印在状态栏
    ```
    
    ```
    :s /s1/s2                            // 光标位于待处理的行上，用s2代替该行上出现的第一个s1
    :s /s1/s2/g                         // 光标位于待处理的行上，用s2代替该行上所有的s1
    ```
    
- 全局替换
    
    ```
    :g /模式/命令表                  // 一种组合命令，它用单个命令就可以执行对文件的复杂修改。
    ```
    
    g(global)命令分为两个执行阶段，第一阶段对编辑缓冲区中与给定模式相匹配的各行做上标记；第二阶段对每个标记行执行给出的命令(以行为单位执行命令，融合了行编辑器特点)。
    
    ```
    :g /s1/p                            // 打印(print)当前编辑文件中包含字符串s1的所有行
    :g /s1/s//s2                    // 在包含s1的所有行中，用字符串s2替换(substitute)首次出现的s1
    :g /s1/s//s2/g              // 用字符串s2替换所有的s1,不论一行中出现了几次
    :g /s1/s//s2/gp             // 用字符串s2替换所有的s1,不论一行中出现了几次,并将修改过的行显示在屏幕上
    :g /s1/s//s2/gc             // 确认替换(confirm)，用字符串s2替换所有的s1
    :g /^/s//`space`/g      // 在文件每一行的开头插入空格
    :g /s0/s/s1/s2/g            // 先将匹配s0的行做上标记，在这些标记的行里将s1全部替换成s2
    ```
    
    以上例子中的命令表都由局部替换完成。下面的例子也类似
    
    ```
    :1,$ s/I/i/g                // 从文件的第一行(1)到文件末尾(实质是缓冲区中最后一行)($)将所有(g)大写I替换(s)成小写i
    ```
    

## EX命令

**ex是面向行编辑器的，所以必须要先将光标移到指定行**。所有的ex命令都通过`Enter`键执行，`del`键终止。

```
.                       //  当前行
n                           //  编辑器缓冲区的第n行，行号从1开始
$                           //  缓冲区中的最后一行
0                           //  缓冲区中的第一行
%                           //  1,$的缩写 从第一行到缓冲区最后一行
+n or -n            //  n表示相对当前行的位移     如果当前行是100行,+3是103行,-5是95行,光标自动置于行首
,                           //  命令地址由多个组成时(如表示范围),各地址间用(逗号)隔开
```

```
:15,100d            //  delete删除15行到100行,因为ex命令面向行，所以只能处理行
:.,+9d              //  delete删除当前行和它后面9行，因为ex命令面向行，所以只能处理行
```

**另外，ex命令也能完成写文件或读文件、跳到shell状态或者切换编辑的文件**。

```
w                           //  写命令，把编辑缓冲区内容写入当前文件或者别的文件中
w file              //  把编辑缓冲区内容写到指定文件中，若文件不存在就创建它。忽略文件名时，写到当前文件中
w >> file           //  把编辑缓冲区内容附加到文件末尾，不破环先前文件内容
q                           //  退出命令，从vi回到shell(编辑缓冲区内容未发生变化才行)
q!                      //  强行退出vi
wq file             //  将编辑缓冲区内容写入file并退出vi，忽略文件名时，写到当前文件中
x file              //  当编辑缓冲区内容未发生变化时等价于q，当编辑缓冲区内容发生变化时等价于wq
```

## Conclusion

- [x]  进入和退出vi，进入时光标恰好在指定词或行
- [x]  光标移动（按字符移动、词移动、句子移动、行移动、列移动、屏幕大小移动），命令模式与ex模式的操作
- [x]  删除字符、词、行、段落、整篇文章内容、恢复
- [x]  行拼接、行或段落的位移
- [x]  内容查找，内容替换（局部替换，全局替换） 

**由于ex命令是面向行编辑的，所以某些面向行的操作，ex命令也能完成。内容查找与替换在vi中完全是以行为单位来处理的，所以都要依靠ex命令**。
因为ex模式只能针对行操作,所以字符、词与句子的位移与删除不能做到。




